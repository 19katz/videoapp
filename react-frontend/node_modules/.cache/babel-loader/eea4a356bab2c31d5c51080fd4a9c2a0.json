{"ast":null,"code":"import React,{Component}from'react';import logo from\"./logo.svg\";import'./App.css';import Video from'twilio-video';var App=function App(){var usernameInput=document.getElementById('username');var button=document.getElementById('join_leave');var container=document.getElementById('container');var count=document.getElementById('count');var connected=false;var room;var connect=function connect(){// get a token from the back end\nvar username=usernameInput.value;if(!username){alert('Enter your name before connecting');return;}button.disabled=true;button.innerHTML='Connecting...';fetch('/login',{method:'POST',body:JSON.stringify({'username':username})}).then(function(res){return res.json();}).then(function(data){// join video call\nVideo.connect(data.token).then(function(_room){room=_room;room.participants.forEach(participantConnected);room.on('participantConnected',participantConnected);room.on('participantDisconnected',participantDisconnected);connected=true;button.innerHTML='Leave call';button.disabled=false;updateParticipantCount();});}).catch(function(){alert('Could not obtain token. Is the backend running?');button.innerHTML='Join call';button.disabled=false;});};var disconnect=function disconnect(){room.disconnect();while(container.childNodes.length>1){container.removeChild(container.lastChild);}button.innerHTML='Join call';connected=false;updateParticipantCount();};var submitButtonHandler=function submitButtonHandler(event){event.preventDefault();if(!connected)connect();else disconnect();};var addParticipantDiv=function addParticipantDiv(sid,name){var participant=document.createElement('div');participant.setAttribute('id',sid);participant.setAttribute('class','participant');var tracks=document.createElement('div');participant.appendChild(tracks);var label=document.createElement('div');label.innerHTML=name;participant.appendChild(label);container.appendChild(participant);return participant;};var participantConnected=function participantConnected(participant){var div=addParticipantDiv(participant.sid,participant.identity);participant.on('trackSubscribed',function(track){return trackSubscribed(div,track);});participant.on('trackUnsubscribed',trackUnsubscribed);participant.tracks.forEach(function(publication){if(publication.isSubscribed)trackSubscribed(div,publication.track);});updateParticipantCount();};var participantDisconnected=function participantDisconnected(participant){document.getElementById(participant.sid).remove();updateParticipantCount();};var trackSubscribed=function trackSubscribed(div,track){div.firstChild.appendChild(track.attach());};var trackUnsubscribed=function trackUnsubscribed(track){track.detach().forEach(function(element){return element.remove();});};var updateParticipantCount=function updateParticipantCount(){if(!connected)count.innerHTML='Disconnected.';else count.innerHTML=room.participants.size+1+' participants online.';};var addLocalVideo=function addLocalVideo(){Video.createLocalVideoTrack({width:240}).then(function(track){var div=addParticipantDiv('local','Me');trackSubscribed(div,track);updateParticipantCount();});};return React.createElement(\"div\",{className:\"App\"},React.createElement(\"h1\",null,\"Flask & Twilio Video Conference\"),React.createElement(\"form\",null,\"Name: \",React.createElement(\"input\",{type:\"text\",id:\"username\"}),React.createElement(\"button\",{id:\"join_leave\"},\"Join call\")),React.createElement(\"p\",{id:\"count\"}),React.createElement(\"div\",{id:\"container\",class:\"container\"}));addLocalVideo();button.addEventListener('click',submitButtonHandler);};export default App;","map":{"version":3,"sources":["/Users/katherinezhang/twilio-video-react-hooks/react-frontend/src/App.js"],"names":["React","Component","Video","App","usernameInput","document","getElementById","button","container","count","connected","room","connect","username","value","alert","disabled","innerHTML","fetch","method","body","JSON","stringify","then","res","json","data","token","_room","participants","forEach","participantConnected","on","participantDisconnected","updateParticipantCount","catch","disconnect","childNodes","length","removeChild","lastChild","submitButtonHandler","event","preventDefault","addParticipantDiv","sid","name","participant","createElement","setAttribute","tracks","appendChild","label","div","identity","track","trackSubscribed","trackUnsubscribed","publication","isSubscribed","remove","firstChild","attach","detach","element","size","addLocalVideo","createLocalVideoTrack","width","addEventListener"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport Video from 'twilio-video';\n\nconst App = () => {\nconst usernameInput = document.getElementById('username');\nconst button = document.getElementById('join_leave');\nconst container = document.getElementById('container');\nconst count = document.getElementById('count');\nvar connected = false;\nvar room;\n\nvar connect = () => {\n    // get a token from the back end\n    var username = usernameInput.value;\n    if (!username) {\n        alert('Enter your name before connecting');\n        return;\n    }\n    button.disabled = true;\n    button.innerHTML = 'Connecting...';\n\n    fetch('/login', {\n        method: 'POST',\n        body: JSON.stringify({'username': username})\n    }).then(res => res.json()).then(data => {\n        // join video call\n        Video.connect(data.token).then(_room => {\n            room = _room;\n            room.participants.forEach(participantConnected);\n            room.on('participantConnected', participantConnected);\n            room.on('participantDisconnected', participantDisconnected);\n            connected = true;\n            button.innerHTML = 'Leave call';\n            button.disabled = false;\n            updateParticipantCount();\n        });\n    }).catch(() => {\n        alert('Could not obtain token. Is the backend running?');\n        button.innerHTML = 'Join call';\n        button.disabled = false;\n    });\n};\n\nconst disconnect = () => {\n    room.disconnect();\n    while (container.childNodes.length > 1)\n        container.removeChild(container.lastChild);\n    button.innerHTML = 'Join call';\n    connected = false;\n    updateParticipantCount();\n};\n\nconst submitButtonHandler = (event) => {\n    event.preventDefault();\n    if (!connected)\n        connect();\n    else\n        disconnect();\n};\n\nconst addParticipantDiv = (sid, name) => {\n    var participant = document.createElement('div');\n    participant.setAttribute('id', sid);\n    participant.setAttribute('class', 'participant');\n\n    var tracks = document.createElement('div');\n    participant.appendChild(tracks);\n\n    var label = document.createElement('div');\n    label.innerHTML = name;\n    participant.appendChild(label);\n\n    container.appendChild(participant);\n    return participant;\n};\n\nconst participantConnected = (participant) => {\n    var div = addParticipantDiv(participant.sid, participant.identity);\n\n    participant.on('trackSubscribed', track => trackSubscribed(div, track));\n    participant.on('trackUnsubscribed', trackUnsubscribed);\n\n    participant.tracks.forEach(publication => {\n        if (publication.isSubscribed)\n            trackSubscribed(div, publication.track);\n    });\n\n    updateParticipantCount();\n};\n\nconst participantDisconnected = (participant) => {\n    document.getElementById(participant.sid).remove();\n    updateParticipantCount();\n};\n\nconst trackSubscribed = (div, track) => {\n    div.firstChild.appendChild(track.attach());\n};\n\nconst trackUnsubscribed = (track) => {\n    track.detach().forEach(element => element.remove());\n};\n\nconst updateParticipantCount = () => {\n    if (!connected)\n        count.innerHTML = 'Disconnected.';\n    else\n        count.innerHTML = (room.participants.size + 1) + ' participants online.';\n};\n\nconst addLocalVideo = () => {\n    Video.createLocalVideoTrack({width: 240}).then(track => {\n        var div = addParticipantDiv('local', 'Me');\n        trackSubscribed(div, track);\n        updateParticipantCount();\n    });\n};\n\n\n    return (\n      <div className=\"App\">\n        <h1>Flask & Twilio Video Conference</h1>\n        <form>\n            Name: <input type=\"text\" id=\"username\"/>\n            <button id=\"join_leave\">Join call</button>\n        </form>\n        <p id=\"count\"></p>\n        <div id=\"container\" class=\"container\"></div>\n      </div>\n            );\n\naddLocalVideo();\nbutton.addEventListener('click', submitButtonHandler);\n\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}