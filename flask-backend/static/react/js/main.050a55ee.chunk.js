(this["webpackJsonpreact-express-starter"]=this["webpackJsonpreact-express-starter"]||[]).push([[0],{184:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(66),o=n.n(c),i=(n(74),n(75),n(26)),u=n.n(i),l=n(67),m=n(7),s=function(e){var t=e.username,n=e.handleUsernameChange,a=e.roomName,c=e.handleRoomNameChange,o=e.handleSubmit;return r.a.createElement("form",{onSubmit:o},r.a.createElement("h2",null,"Enter a room"),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"name"},"Name:"),r.a.createElement("input",{type:"text",id:"field",value:t,onChange:n,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"room"},"Room name:"),r.a.createElement("input",{type:"text",id:"room",value:a,onChange:c,required:!0})),r.a.createElement("button",{type:"submit"},"Submit"))},f=n(13),d=n(68),p=n.n(d),h=function(e){var t=e.participant,n=Object(a.useState)([]),c=Object(m.a)(n,2),o=c[0],i=c[1],u=Object(a.useState)([]),l=Object(m.a)(u,2),s=(l[0],l[1]),d=Object(a.useRef)(),p=Object(a.useRef)(),h=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(a.useEffect)((function(){return i(h(t.videoTracks)),s(h(t.audioTracks)),t.on("trackSubscribed",(function(e){"video"===e.kind?i((function(t){return[].concat(Object(f.a)(t),[e])})):s((function(t){return[].concat(Object(f.a)(t),[e])}))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?i((function(t){return t.filter((function(t){return t!==e}))})):s((function(t){return t.filter((function(t){return t!==e}))}))})),function(){i([]),s([]),t.removeAllListeners()}}),[t]),Object(a.useEffect)((function(){var e=o[0];if(e)return e.attach(d.current),function(){e.detach()}}),[o]),r.a.createElement("div",{className:"participant"},r.a.createElement("h3",null,t.identity),r.a.createElement("video",{ref:d,autoPlay:!0}),r.a.createElement("audio",{ref:p,autoPlay:!0,muted:!0}))},b=function(e){var t=e.roomName,n=e.token,c=e.handleLogout,o=Object(a.useState)(null),i=Object(m.a)(o,2),u=i[0],l=i[1],s=Object(a.useState)([]),d=Object(m.a)(s,2),b=d[0],E=d[1],v=b.map((function(e){return r.a.createElement(h,{key:e.sid,participant:e})}));return Object(a.useEffect)((function(){var e=function(e){E((function(t){return[].concat(Object(f.a)(t),[e])}))},a=function(e){E((function(t){return t.filter((function(t){return t!==e}))}))};return p.a.connect(n,{name:t}).then((function(t){l(t),t.on("participantConnected",e),t.on("participantDisconnected",a),t.participants.forEach(e)})),function(){l((function(e){return e&&"connected"===e.localParticipant.state?(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect(),null):e}))}}),[t,n]),r.a.createElement("div",{className:"room"},r.a.createElement("h2",null,"Room: ",t),r.a.createElement("button",{onClick:c},"Log out"),r.a.createElement("div",{className:"local-participant"},u?r.a.createElement(h,{key:u.localParticipant.sid,participant:u.localParticipant}):""),r.a.createElement("h3",null,"Remote Participants"),r.a.createElement("div",{className:"remote-participants"},v))},E=function(){var e=Object(a.useState)(""),t=Object(m.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),i=Object(m.a)(o,2),f=i[0],d=i[1],p=Object(a.useState)(null),h=Object(m.a)(p,2),E=h[0],v=h[1],j=Object(a.useCallback)((function(e){c(e.target.value)}),[]),O=Object(a.useCallback)((function(e){d(e.target.value)}),[]),k=Object(a.useCallback)(function(){var e=Object(l.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/login",{method:"POST",body:JSON.stringify({identity:n,room:f}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:a=e.sent,v(a.token);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,f]),g=Object(a.useCallback)((function(e){v(null)}),[]);return E?r.a.createElement(b,{roomName:f,token:E,handleLogout:g}):r.a.createElement(s,{username:n,roomName:f,handleUsernameChange:j,handleRoomNameChange:O,handleSubmit:k})},v=function(){return r.a.createElement("div",{className:"app"},r.a.createElement("header",null,r.a.createElement("h1",null,"Video Chat with Hooks")),r.a.createElement("main",null,r.a.createElement(E,null)),r.a.createElement("footer",null,r.a.createElement("p",null,"Made with"," ",r.a.createElement("span",{role:"img","aria-label":"React"},"\u269b")," ","by ",r.a.createElement("a",{href:"https://twitter.com/philnash"},"philnash"))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(v,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},69:function(e,t,n){e.exports=n(184)},74:function(e,t,n){},75:function(e,t,n){}},[[69,1,2]]]);
//# sourceMappingURL=main.050a55ee.chunk.js.map